# Официальный модуль приема платежей Robokassa для Joomla VirtueMart 3.4.x
Данный модуль позволяет добавить на сайт способ оплаты через Робокассу. 
Для корректной работы модуля необходима регистрация в сервисе.

Порядок регистрации описан в [документации Robokassa](https://docs.robokassa.ru/#7844)

### Возможности
* Передача состава товаров в заказе для отправки чека клиенту и в налоговую (54-ФЗ);
* Приём платежей в тестовом режиме;
* Автоматическая смена статуса заказа;
* Поддержка продажи через iframe
* Поддержка продавцов из Казахстана

### Совместимость
Virtuemart 3.4.x;

### Установка 

1. Установка плагина выполняется из zip архива, как и любой другой плагин для CMS Joomla.
2. Для этого заходим в административную панель магазина в раздел Расшерения – Менеджер расширений – Установка.
3. Выбираем архив плагина.

### Настройка модуля

1. В личном кабинете Robokassa Вам необходимо указать настройки:

Алгоритм расчета хеша: md5
Result URL : http://ваш_магазин.ru/index.php?option=com_virtuemart&view=pluginresponse&task=pluginnotification&tmpl=component
Success URL : http://ваш_магазин.ru/index.php?option=com_virtuemart&view=pluginresponse&task=pluginresponsereceived
Fail Url : http://ваш_магазин.ru/index.php?option=com_virtuemart&view=pluginresponse&task=pluginUserPaymentCancel
Метод отсылки данных во всех случаях POST.

2. Далее проходим в административную панель магазина на Virtuemart и добавляем новый способ оплаты. Для этого пройдите в раздел Virtuemart – Магазин – Способы оплаты.

3. Жмем на панели сверху Создать.

4. И добавляем новый способ оплаты. Обязательно, в поле Способ оплаты нужно выбрать Robokassa и Опубликовано – Да (если необходимо отображать способ оплаты на этапе оформления заказа). Все остальные поля на Ваше усмотрение.

5. Жмем Сохранить. Далее переключаемся на вкладку "Конфигурация".

6. Заполняем обязательные поля в разделе Технические настройки (данные берем из личного кабинета Robokassa):

* Идентификатор магазина
* Пароль 1
* Пароль 2

7. Если Вы используете тестовые данные – не забудьте переключить настройку "Среда" на "Тестовая".

8. Подтверждаем настройки нажатием кнопки "Сохранить".

9. Настройка завершена.

### Фискализация

Для подключения автоматического формирования чеков в соответвии с ФЗ-54 необходимо подключить одну из доступных фискальных схем в Личном кабинете Robokassa ([Раздел "Фискализация"](https://partner.robokassa.ru/Fiscalization)) и указать настройки модуля:

* Фискализация - "Да".
* Система налогообложения.
* Признак способа расчёта.
* Признак предмета расчёта.
* Налог.

### Уведомления об оплате

Уведомление об оплате Robokassa отправляет автоматически, после успешного совершения платежа, на адрес Result URL, который был скопирован из настроек модуля и указан в технических настройках магазина. После получения уведомления, заказ в CMS изменит статус на тот, который указан в подразделе "Статусы заказов".
При правильной настройке Robokassa самостоятельно сообщит в модуль статус оплаты, после чего статус заказа изменится согласно настройкам.
